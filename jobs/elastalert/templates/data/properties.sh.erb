#!/usr/bin/env bash

# job template binding variables

# job name & index of this VM within cluster
# e.g. JOB_NAME=redis, JOB_INDEX=0
export NAME='<%= name %>'
export JOB_INDEX=<%= index %>
# full job name, like redis/0 or webapp/3
export JOB_FULL="$NAME/$JOB_INDEX"

export EA_BIN=/var/vcap/packages/elastalert/bin
export PYTHONPATH=/var/vcap/packages/elastalert/lib/python2.7/site-packages

export ES_HOST='<%= p("elasticsearch.host") %>'
export ES_PORT='<%= p("elasticsearch.port") %>'

$EA_BIN/elastalert-create-index --host $ES_HOST --port $ES_PORT --index elastalert_status --no-auth --no-ssl --url-prefix "" --old-index None
